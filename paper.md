---
title: 'Hypothesis matrix translation using the hypr package in R'
tags:
  - R
  - psychology
  - linguistics
  - linear regression
  - statistics
  - research methods
  - research hypotheses
authors:
  - name: Maximilian M. Rabe
    orcid: 0000-0002-2556-5644
    affiliation: 1
  - name: Shravan Vasishth
    orcid: 0000-0003-2027-1994
    affiliation: 1
  - name: Sven Hohenstein
    orcid: 0000-0002-9708-1593
    affiliation: 1
  - name: Reinhold Kliegl
    orcid: 0000-0002-0180-8488
    affiliation: 1
  - name: Daniel J. Schad
    orcid: 0000-0003-2586-6823
    affiliation: 1
affiliations:
 - name: University of Potsdam
   index: 1
date: 8 January 2020
bibliography: paper.bib

---



# Summary

The `hypr` package in R provides the researcher with a straightforward interface to generate contrast matrices from research hypotheses and the reverse. It can therefore be used both for safely deriving contrast matrices for custom research hypotheses and as an instructional tool to understand what research hypotheses a given contrast matrix is really testing.

# Contrast coding in R

In many empirical sciences, linear regressions and variants are used to investigate the statistical relationship between a continuous *dependent (outcome) variable*, such as response times or percent correct in cognitive research, and one or more *independent (explanatory) variables*. If independent variables are categorical (or, `factor` instances in R), such as the assignment to a treatment group or other categorical experimental conditions, the researcher must decide how to code the contrasts between the levels of that independent variable, typically termed *contrast coding*.

For many common applications, coding schemes are readily available as part of the base R `stats` package. One such example is `contr.treatment()` for treatment contrasts. Each of these functions generates a *contrast matrix* like this:


```r
contr.treatment(c("baseline","trt1","trt2"))
```

```
##          trt1 trt2
## baseline    0    0
## trt1        1    0
## trt2        0    1
```

A contrast matrix can be easily assigned to a `factor` like this:


```r
contrasts(some_factor) <- contr.treatment(c("baseline","trt1","trt2"))
```

When fitting a linear regression model, R will transform the factor to as many contrasts as there are columns and assign the respective contrast code to each observation based on its value for the factor `some_factor`.

# Contrast coding with hypr

While for simpler contrast coding schemes, contrast matrices may be easily interpretable, they are often misunderstood and incorrectly generated when custom research hypotheses are to be tested. The `hypr` package in R provides a set of functions to translate an arbitrary number of research hypotheses into a contrast matrix and the reverse. Its methodolgy is based on the tutorial by @Schad2020.

Most importantly, the package provides the `hypr()` function which constructs a `hypr` object. An arbitrary number of research (null) hypotheses can be passed as arguments. For example, to create a `hypr` object that tests a baseline condition against zero and two treatments against the baseline (i.e., a treatment contrast with one baseline and two treatments), can be created like so:


```r
trtC <- hypr(baseline~0, trt1~baseline, trt2~baseline)
trtC
```

```
## hypr object containing 3 null hypotheses:
## H0.1: 0 = baseline
## H0.2: 0 = trt1 - baseline
## H0.3: 0 = trt2 - baseline
## 
## Hypothesis matrix (transposed):
##          [,1] [,2] [,3]
## baseline  1   -1   -1  
## trt1      0    1    0  
## trt2      0    0    1  
## 
## Contrast matrix:
##          [,1] [,2] [,3]
## baseline 1    0    0   
## trt1     1    1    0   
## trt2     1    0    1
```

As can be seen above, the object contains three research (null) hypotheses:

$$\begin{align}
H_{0_1}:& \; \mu_1 = 0 \\
H_{0_2}:& \; \mu_2 = \mu_1 \\
H_{0_3}:& \; \mu_3 = \mu_1
\end{align}$$

In addition to storing the hypotheses, the function constructs a hypothesis matrix, which represents the coefficients of each respective term used in the hypothesis equations. The generalized inverse of that matrix is the corresponding contrast matrix.

With the provided `contr.hypothesis()` function, the resulting contrast matrix (as seen in the lower third of the output) can be derived and -- as to be expected -- equals the output of the `contr.treatment(3)` function call:


```r
contr.hypothesis(trtC)
```

```
##          [,1] [,2]
## baseline    0    0
## trt1        1    0
## trt2        0    1
```

This matrix can be assigned to a factor in the same way as the matrices generated by the `contr.*()` functions in R:


```r
contrasts(some_factor) <- contr.hypothesis(trtC)
```

More useful function to retrieve and modify a `hypr` object's contrast matrix or (transposed) hypothesis matrix, are `cmat()`, `thmat()` and `hmat()`, respectively.

# Contrast validation with hypr

As previously mentioned, `hypr` can also be used to derive a set of tested research (null) hypotheses represented by a given contrast matrix. This can be very useful to understand what a given contrast matrix is testing and, consequently, verify that the contrast matrix is testing as intended.

To do so, one can create an empty `hypr` object and set its contrast matrix to whatever matrix is to be inspected. Take for example an effects coding contrast:


```r
sumC <- hypr()
cmat(sumC) <- contr.sum(4) # note we are adding an intercept here
sumC
```

```
## hypr object containing 3 null hypotheses:
## H0.1: 0 = 3/4*mu1 - 1/4*mu2 - 1/4*mu3 - 1/4*mu4
## H0.2: 0 = -1/4*mu1 + 3/4*mu2 - 1/4*mu3 - 1/4*mu4
## H0.3: 0 = -1/4*mu1 - 1/4*mu2 + 3/4*mu3 - 1/4*mu4
## 
## Hypothesis matrix (transposed):
##     [,1] [,2] [,3]
## mu1  3/4 -1/4 -1/4
## mu2 -1/4  3/4 -1/4
## mu3 -1/4 -1/4  3/4
## mu4 -1/4 -1/4 -1/4
## 
## Contrast matrix:
##     [,1] [,2] [,3]
## mu1  1    0    0  
## mu2  0    1    0  
## mu3  0    0    1  
## mu4 -1   -1   -1
```

The derived research hypotheses can be rewritten as:

$$\begin{align}
H_{0_1}:&& \mu_1 & = \frac{\mu_1 + \mu_2 + \mu_3 + \mu_4}{4} \\
H_{0_2}:&& \mu_2 & = \frac{\mu_1 + \mu_2 + \mu_3 + \mu_4}{4} \\
H_{0_3}:&& \mu_3 & = \frac{\mu_1 + \mu_2 + \mu_3 + \mu_4}{4}
\end{align}$$

As to be expected for a sum contrast, the contrasts test all but one group against the mean of all groups.

# Acknowledgements

The development of this package was supported by German Research Foundation (DFG)/SFB 1287 _Limits of variability in language_ and Center for Interdisciplinary Research, Bielefeld (ZiF)/Cooperation Group _Statistical models for psychological and linguistic data_.

# References
